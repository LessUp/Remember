# 架构概览

## 项目形态

- 纯静态前端（无后端、无构建流程）
- 单页应用（SPA），以 `index.html + app.js` 驱动
- 数据持久化使用 `localStorage`
- PWA：`sw.js` 负责离线缓存，`manifest.webmanifest` 提供安装元信息

## 关键文件职责

- **`index.html`**
  - UI 结构：顶部工具栏、卡牌网格、多个模态框（设置/统计/成就/每日挑战/回忆测验/N-back/指南）
  - Tailwind CSS 通过 CDN 注入

- **`app.js`**
  - 游戏主流程：开局、翻牌、配对判定、胜负结算
  - 多训练模式：经典/限时/每日挑战/回忆测验/N-back
  - 自适应辅助：根据评分动态调整预览秒数与提示次数
  - 间隔复现：易错卡面权重机制（后续可升级 SM-2/Leitner）
  - 统计/成就/排行榜
  - 导入/导出备份
  - 国际化（zh/en/auto）

- **`sw.js`**
  - 预缓存核心静态资源
  - 对 Tailwind CDN 做运行时缓存（离线样式兜底）

- **`manifest.webmanifest`**
  - PWA 名称、主题色、启动范围、图标

## 运行时数据流（高层）

- `DOMContentLoaded`
  - 绑定 DOM 元素引用
  - 读取 `settings` / `stats` / `achievements` 等
  - 应用主题/动效偏好/语言
  - 注册 Service Worker
  - 调用 `initGame()` 进入可玩状态

- 游戏进行中
  - `onFlip()` 管理两张翻牌的状态机
  - 成功配对：累积连击、更新进度条、锁定卡片
  - 失败翻牌：延时翻回，继续下一轮

- 结算
  - `onWin()`：记录最佳/排行榜/统计/自适应/间隔复现；打开回忆测验
  - `onTimeUp()`：限时模式判负

## 架构改进方向（规划）

在保持“纯静态、无构建”前提下，建议分阶段拆分 `app.js`：

- 第 1 阶段：按职责在文件内分区（状态/存储/UI/模式）并抽出纯函数，提升可测性
- 第 2 阶段：迁移到原生 ES Modules（多个 `.js` 文件），由 `index.html` 以 `type="module"` 加载
- 第 3 阶段：为复杂模式（如 SM-2、双任务干扰、交错训练）引入独立模块与数据版本迁移
